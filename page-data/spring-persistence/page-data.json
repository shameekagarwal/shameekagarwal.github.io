{"componentChunkName":"component---src-templates-blog-js","path":"/spring-persistence/","result":{"data":{"markdownRemark":{"fields":{"slug":"/spring-persistence/"},"id":"30896e2e-6c5f-59db-8d38-45cfee7e3a2f","html":"<h1 id=\"about\" style=\"position:relative;\"><a href=\"#about\" aria-label=\"about permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About</h1>\n<ul>\n<li>orm - object relation mapping,\n<ul>\n<li>map a pojo (plain old java object) to the table rows in the database</li>\n<li>handle relationships like one to many, etc</li>\n<li>we just have to configure entities using right annotations, sql queries are automatically generated</li>\n</ul>\n</li>\n<li>spring data has support for common persistence solutions like redis, mongodb, sql based databases, etc</li>\n<li>spring data jpa is an abstraction layer over hibernate</li>\n<li>hibernate it is an implementation of jpa (java persistence api)</li>\n<li>jdbc or java database connectivity helps connect to a database</li>\n<li>jdbc too is just an api which jdbc drivers implement, e.g. there are different drivers for postgres and mysql</li>\n<li>we use repositories which handle everything related to persistence. we just have to declare an interface while spring data jpa provides us with the implementation</li>\n<li>relational databases are very efficient, data jpa is not that efficient &#x26; so it is not great for batch operations</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 551px; margin: 5px 0 5px 0 !important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d5c23832a605d402eb8ab1819bdeb469/db783/persistence-layers.drawio.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.253164556962027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtElEQVQY0zVQywqAMAzz///I58Hrbh68KSIMcSgovp+RBByMtGmbdPMA4H1fAs7zRNd1sNZiXVfc941t29A0DfZ9V52373vM86z4ui7UdY0sy+CcgzcMg4rHcUiUyGGK/SbkiDzkWSf3PI+4aZq0CJfw2rbFOI5yJVJ8WRbFNGMzc/J//nNE9hFpIkE+pyxLJUVRIIoiBEEAY4wE0jQVR+QWeZ4jDEMkSYKqqvQ9vu+rJ45jfIFJLHY+Ac7HAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"persistence layers\"\n        title=\"persistence layers\"\n        src=\"/static/d5c23832a605d402eb8ab1819bdeb469/db783/persistence-layers.drawio.png\"\n        srcset=\"/static/d5c23832a605d402eb8ab1819bdeb469/c26ae/persistence-layers.drawio.png 158w,\n/static/d5c23832a605d402eb8ab1819bdeb469/6bdcf/persistence-layers.drawio.png 315w,\n/static/d5c23832a605d402eb8ab1819bdeb469/db783/persistence-layers.drawio.png 551w\"\n        sizes=\"(max-width: 551px) 100vw, 551px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"equals-and-hashcode\" style=\"position:relative;\"><a href=\"#equals-and-hashcode\" aria-label=\"equals and hashcode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Equals and HashCode</h1>\n<p>we should generate <code class=\"language-text\">equals</code> and <code class=\"language-text\">hashCode</code> based on id field. to work with lombok, use <a href=\"https://stackoverflow.com/a/56908141/11885333\">this</a></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token operator\">==</span> o<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>o <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> o<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">Book</span> book <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Book</span><span class=\"token punctuation\">)</span> o<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> book<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">hashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">hash</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id=\"repositories\" style=\"position:relative;\"><a href=\"#repositories\" aria-label=\"repositories permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Repositories</h1>\n<ul>\n<li><code class=\"language-text\">@CrudRepository</code> &#x26; <code class=\"language-text\">@PagingAndSortingRepository</code> are a part of spring data commons, i.e. if we use them we can easily switch between databases if we wanted to later on while the code would not change</li>\n<li>spring data commons is what various distributions like spring data jpa, spring data mongodb, etc implement</li>\n<li><code class=\"language-text\">@JpaRepository</code> is a part of spring data jpa and helps get a lot of jpa specific functionality with this as well</li>\n</ul>\n<h1 id=\"accounts\" style=\"position:relative;\"><a href=\"#accounts\" aria-label=\"accounts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Accounts</h1>\n<ul>\n<li>we should create a separate schema / database for each application</li>\n<li>we should create two accounts which can perform operations on this database only</li>\n<li>one account should have higher privileges, as it would carry out database migrations while the other account should be restricted to run crud operations only</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">user</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>account_service_user<span class=\"token punctuation\">`</span></span><span class=\"token variable\">@`%`</span> identified <span class=\"token keyword\">with</span> mysql_native_password <span class=\"token keyword\">by</span> <span class=\"token string\">'ghXrqvPhKuI6RedaEh7l'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">grant</span> <span class=\"token keyword\">select</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">insert</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">update</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">delete</span> <span class=\"token keyword\">on</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>account_service<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">to</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>account_service_user<span class=\"token punctuation\">`</span></span><span class=\"token variable\">@`%`</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">user</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>account_service_admin<span class=\"token punctuation\">`</span></span><span class=\"token variable\">@`%`</span> identified <span class=\"token keyword\">with</span> mysql_native_password <span class=\"token keyword\">by</span> <span class=\"token string\">'m9EfTq7RfbFdUqGWS0OM'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">grant</span> <span class=\"token keyword\">select</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">insert</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">update</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">delete</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">create</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">drop</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">references</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">alter</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">execute</span> <span class=\"token keyword\">on</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>account_service<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">to</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>account_service_admin<span class=\"token punctuation\">`</span></span><span class=\"token variable\">@`%`</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id=\"hibernate-schema-generation\" style=\"position:relative;\"><a href=\"#hibernate-schema-generation\" aria-label=\"hibernate schema generation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hibernate Schema Generation</h1>\n<ul>\n<li>hibernate can use sql statements to automatically generate ddl (data definition language)</li>\n<li>the different available options can be viewed <a href=\"https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#configurations-hbmddl\">here</a>\n<ul>\n<li><code class=\"language-text\">create</code> - drop the schema and recreate it and the tables from the entities</li>\n<li><code class=\"language-text\">validate</code> - if the tables don’t match the entities, results in a fatal error. it’s a fail fast approach which is preferred in production to prevent bugs</li>\n<li><code class=\"language-text\">update</code> - update the tables from the entities. good for rapid prototyping</li>\n<li><code class=\"language-text\">create-drop</code> - like <code class=\"language-text\">create</code> but drop the tables after the application shuts down</li>\n</ul>\n</li>\n<li>it converts camel case to snake case by default for attributes</li>\n<li>the exact property name is <code class=\"language-text\">spring.jpa.hibernate.ddl-auto=update</code></li>\n</ul>\n<h1 id=\"flyway\" style=\"position:relative;\"><a href=\"#flyway\" aria-label=\"flyway permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Flyway</h1>\n<ul>\n<li>database migration - helps upgrade schemas and tables, go back to an older state, etc. without the loss of data</li>\n<li>commands -\n<ul>\n<li><code class=\"language-text\">migrate</code> - migrate to the latest version</li>\n<li><code class=\"language-text\">clean</code> - drop all database objects, <strong>should not be used for production</strong></li>\n<li><code class=\"language-text\">info</code> - print information about the migrations</li>\n<li><code class=\"language-text\">validate</code> - check if migrations have been applied</li>\n<li><code class=\"language-text\">undo</code> - revert most recent migration</li>\n<li><code class=\"language-text\">baseline</code> - used when flyway is introduced to an existing database</li>\n<li><code class=\"language-text\">repair</code> - used to fix problems with schema history table</li>\n</ul>\n</li>\n<li>file naming convention - <code class=\"language-text\">V&lt;version-number>__comment.sql</code> e.g. <code class=\"language-text\">V1.0__init-database.sql</code></li>\n<li>running flyway commands from code. e.g. -\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Profile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"clean\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DBClean</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Bean</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">FlywayMigrationStrategy</span> <span class=\"token function\">clean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> flyway <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n      flyway<span class=\"token punctuation\">.</span><span class=\"token function\">clean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      flyway<span class=\"token punctuation\">.</span><span class=\"token function\">migrate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id=\"primary-keys\" style=\"position:relative;\"><a href=\"#primary-keys\" aria-label=\"primary keys permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Primary Keys</h1>\n<ul>\n<li><code class=\"language-text\">@Id</code> - it helps map a pojo to the primary key of the table</li>\n<li><code class=\"language-text\">@GeneratedValue</code> - how the id field should be generated. if the strategy is <code class=\"language-text\">GenerationType.AUTO</code>, hibernate picks up the correct strategy automatically based on the type of the database. when we use <code class=\"language-text\">GenerationType.AUTO</code> with mysql, it defaults to <code class=\"language-text\">GenerationType.TABLE</code> i.e. a table is used to maintain the id value. it is not scalable as a table is created and queried. <code class=\"language-text\">GenerationType.IDENTITY</code> allows for auto-incremented database columns</li>\n<li>uuid - 128 bit unique identifier. helps in database indexing, but does require more storage</li>\n<li>adding a uuid column -\n<ul>\n<li>migration script -\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> book change id id <span class=\"token keyword\">binary</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n</li>\n<li>id attribute -\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Id</span>\n<span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>generator <span class=\"token operator\">=</span> <span class=\"token string\">\"uuid2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@GenericGenerator</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"uuid2\"</span><span class=\"token punctuation\">,</span> strategy <span class=\"token operator\">=</span> <span class=\"token string\">\"uuid2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>columnDefinition <span class=\"token operator\">=</span> <span class=\"token string\">\"binary(16)\"</span><span class=\"token punctuation\">,</span> updatable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">UUID</span> id<span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n</li>\n<li>another approach commonly used is to not use the auto generated database id, and instead of it add another public id like uuid which is used by the frontend to communicate with the backend. the database id is just stored in the database and not used</li>\n</ul>\n<h1 id=\"hibernate-terms\" style=\"position:relative;\"><a href=\"#hibernate-terms\" aria-label=\"hibernate terms permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hibernate Terms</h1>\n<ul>\n<li><code class=\"language-text\">SessionFactory</code> - expensive to create, therefore the application should have only one instance of it. its jpa equivalent is <code class=\"language-text\">EntityManagerFactory</code></li>\n<li><code class=\"language-text\">Session</code> - single threaded, short-lived and inexpensive to create. it is a wrapper around a jdbc connection and its jpa equivalent is <code class=\"language-text\">EntityManager</code></li>\n<li><code class=\"language-text\">Transaction</code> - single threaded, used to define transaction boundaries. its jpa equivalent is <code class=\"language-text\">EntityTransaction</code></li>\n<li>entity states -\n<ul>\n<li>transient - not associated with a session as it has just been instantiated</li>\n<li>managed or persistent - associated with a session, changes may not have been propagated to the db</li>\n<li>detached - not being tracked by a session as session was closed / it was evicted from the session</li>\n<li>removed - scheduled for removal from the database</li>\n</ul>\n</li>\n<li>caching - hibernate has two levels of cache\n<ul>\n<li>first level cache - hibernate will cache entities in the session, makes operations efficient</li>\n<li>second level cache - disabled by default, recommended to enable on a per-entity basis</li>\n</ul>\n</li>\n<li>caching problems - if we try to insert a lot of objects into the database at once, our jvm memory can blow up as there would be a lot of  objects in the cache. we can fix this using jdbc batching, so that operations happen in batches. <code class=\"language-text\">flush()</code> and <code class=\"language-text\">clear()</code> methods help clear session cache</li>\n</ul>\n<h1 id=\"mapping-examples\" style=\"position:relative;\"><a href=\"#mapping-examples\" aria-label=\"mapping examples permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mapping Examples</h1>\n<details>\n  <summary>One to One Bidirectional</summary>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Owner</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@OneToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token annotation punctuation\">@ToString.Exclude</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Car</span> car<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Car</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> model<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@OneToOne</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"car\"</span><span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token annotation punctuation\">@ToString.Exclude</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Owner</span> owner<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</details>\n<details>\n  <summary>One to Many Bidirectional</summary>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Cart</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>\n      mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"cart\"</span><span class=\"token punctuation\">,</span>\n      cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">,</span>\n      orphanRemoval <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token annotation punctuation\">@ToString.Exclude</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> items <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token annotation punctuation\">@ToString.Exclude</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Cart</span> cart<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</details>\n<details>\n  <summary>Many to Many Bidirectional</summary>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Stream</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@ManyToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"streams\"</span><span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token annotation punctuation\">@ToString.Exclude</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Viewer</span><span class=\"token punctuation\">></span></span> viewers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Viewer</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@ManyToMany</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n  <span class=\"token annotation punctuation\">@ToString.Exclude</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Stream</span><span class=\"token punctuation\">></span></span> streams <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</details>\n<details>\n  <summary>Mapped Superclass</summary>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@MappedSuperclass</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Vehicle</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">AUTO</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Truck</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Vehicle</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> load<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span> <span class=\"token annotation punctuation\">@Setter</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span> <span class=\"token annotation punctuation\">@AllArgsConstructor</span> <span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Tank</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Vehicle</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> firePower<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</details>\n<h1 id=\"mapping-tips\" style=\"position:relative;\"><a href=\"#mapping-tips\" aria-label=\"mapping tips permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mapping Tips</h1>\n<ul>\n<li><code class=\"language-text\">mappedBy</code> signifies that the current class is the child / non owner side of the relationship. in many to many, it can be placed on either side of the relationship</li>\n<li><code class=\"language-text\">@JoinColumn</code>, is used for both one-to-one and one-to-many and is optional. it helps specify the name of the columns to use in database tables. it is used on the owner side of the relation</li>\n<li><code class=\"language-text\">@JoinTable</code>, is used for many-to-many and is optional. it helps specify the name of the columns and table which is used for maintaining the mapping. it is used on the side of the relation where <code class=\"language-text\">mappedBy</code> was not used</li>\n<li>by default some fetch types are eager, and some like <code class=\"language-text\">@OneToMany</code> are lazy</li>\n<li>set <code class=\"language-text\">orphanRemoval</code> to true to delete entities which have been removed from the relationship, default is false</li>\n<li>use <code class=\"language-text\">CascadeType.ALL</code>, specially for owner relations, this way if the owner gets deleted, its child is deleted too. also, the child would automatically get persisted to database, e.g.\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\">cart<span class=\"token punctuation\">.</span><span class=\"token function\">addItem</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncartRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>cart<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// this line would save item to the database as well</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>use <code class=\"language-text\">@ToString.Exclude</code> of lombok for all relation attributes</li>\n<li>use <code class=\"language-text\">@MappedSuperclass</code> for a base entity from which all other entities can inherit. this base entity should be an abstract class so that no one can instantiate it, and it can have all common attributes required by all entities like version, created and updated at, id, etc</li>\n<li>in single table strategy, only one database table would be created for all classes, with columns corresponding to union of all the attributes for all entities including parent. to decide which class the row belongs to, a column is used. this column is <code class=\"language-text\">DTYPE</code> by default, and can be overridden using <code class=\"language-text\">@DiscriminatorColumn</code>. in this example, <code class=\"language-text\">color</code> is present on the child painting while <code class=\"language-text\">mould</code> is present on the child sculpture <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 241px; margin: 5px 0 5px 0 !important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b83d39cc72c81894c101ddc0c3bb3d27/2f862/single-table.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7ElEQVQoz02SDU/bMBCG+/9/yoS0MaSJMQZjBUohbZrW+XDipA4tbWhJmsRpxzpNz0Q72E463SvL9+jse1vr9ZTO1Qds+zNW/4RQXpLIG6y7T7S/feSmc8T15SFCnBH4bS6+HtCzjgjjW563GtMkGDOmrve1ZcyEUf8Op9und22jAsHD1EEKl0je4VoDwsEQ0RkR+gOksLDbNv7AQfsBk9QlLwKM0TvoDmhfBbiXGqet8Z0IrftcfwnRyqF3nDA8GdN5p0n8AGm53BxMsE4iuoeSUAxY5ILmf2AU2YwTD6WGzGdjimJOWc6pygytfSbTiNlMkuqQ2SzhPvUoy4xfvw3rTcmq0BiTUNdjWrWZcK9j5CjAG7kEwqdcFeTLgrUpkZ5ECh/l+bjOCJ2MiTzJZrPlNapqijHxHtg0U+LIJfQjBrc9QhkSBgGLxwWbpkI4guwhe2vOHlKGA4HyBKlSWF2bx0zRNPvFtF62fK990iRGSY9JqtBaUVc5dfmITiLyZcZ22/D8s2GaSiIZMJ/E5IsZ0ndZLuN/QFOn2NYpve4xF+fv8Ubfcexzzk8PiFWXzY+UsowoCrnLsvo7jUmodvrl7+I36+ye/PQUsFopijxkVURUVUJRhJQrtbv4kk2jd9bYN47fzl/1qw//AIcsiyI0rQ9MAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"single table\"\n        title=\"single table\"\n        src=\"/static/b83d39cc72c81894c101ddc0c3bb3d27/2f862/single-table.png\"\n        srcset=\"/static/b83d39cc72c81894c101ddc0c3bb3d27/c26ae/single-table.png 158w,\n/static/b83d39cc72c81894c101ddc0c3bb3d27/2f862/single-table.png 241w\"\n        sizes=\"(max-width: 241px) 100vw, 241px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></li>\n<li>in join table strategy, queries would be inefficient since joins would be required for each retrieval. the parent entity would have all common fields of children and an id and get stored to the database in a table of it own. the child tables would too have an id which gets stored into separate database tables, but their ids would have a foreign key constraint as well, which points to the parent entity. in this example, <code class=\"language-text\">color</code> is present on the parent vehicle while <code class=\"language-text\">numberOfWheels</code> on the child bike and <code class=\"language-text\">model</code> on the child car <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 191px; margin: 5px 0 5px 0 !important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f5418ffabd6e82fc018f57c6021ddd7f/c540e/joined-table.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 155.69620253164555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFIUlEQVRIx5WW6W/bVhbF9f9/KTAYYIrpl0nQNk0niZOJ5SWKI8m2JFu2rH0hxX2nrMXaSG32b0AqdZzELVwCF3zvfTg8975z7mUiDD0cu4pp1bjudbDNKqZRxnObOGYFTb1CVa4w9TKWUUFXy5h6hdFIYjpVmU5UJhM1Xk8mConV6ppi/h2vdp6Ry70ndfALl+e7mHaVUv49e8mf2f3fCw73fyWVfM77V/8hufMMWb0kCDTGE5npXI7BItBEuHDR1Rpyu4bYqiC26uhKG0Pp4HttdFnAtptYWgdFbGJobVS1jixVsa0GulZBFVrYTo3RqEtitXGo5Fuk/2mTfmby9geb/R9NPj7Xaee67P/boHUhcfxc4+BfFqlfDdJvDAp7Gs1iF6leJfOjie3WGA4FEkHgYrsNPE/B8yR8T8Yxo7WMpSv4vozryDi2TO9awrW357ah4PkyltXE91Vcr8NwKJJYLn1kMaLvEz23t3f8nefa0en1RqzXKwYDkUR0y64rMhz22dyGbDYhYThluZqzWs5ZLmeE4eTrCCYEwYTFYsa1bzDo95jNBgyHXRJh4FGvHtGoZTk6fE3uZI9K6SOn6Xdk02+oVbLcjOU4ndHo64jObm4kxmMp3seyCQIPVS5iWVXkbhFROMdx6phaGVk6j3U4m2n3stjqTf281u7P/ojEPHBZLExWK4fVymazifYWi6XFau2yXjuEoUEYmsznOvPAIFyYzGZbIX8biUXooypF6vXTmE2nlaMrnmHbdSShQLWSjVkrUhHTqGBqJdqtHP1B9x70K4bL5TWl4i7JgxecnSXJpn+nUUlhWQ1a1Q8cZ3bYT/6Xw+QLLs8PyaXfkDp8hW7Umc+17wHD0MXUmqgdEakpINa7qLKA51fROh0MVWAwbMdleJjydKp8B7ZlGDnltMH7f+gcPVdI/qSR/6Bg2Vec/daleCTg9Sqfm8CXWn25oG8YBnMX12syGusMRhqDkcx1X8a223i+sHWH13pwCepXoI/UsIcklimcXHCWOaXfn24ds9kgCV1WG5jNekwm0nfpPRaxUzxPRFO6mFok1EHsjum0j++bzIMpo5HxuWZPAQw8quUPNOtZPn14w3H6HWIrQyF3wKePv1MuHT1au78E1NULbLuGHnVnuYTr1nGiXqdeYhjV2BHj8baJ/vH+9iP3wp7PXRbLrVOWS5v1xoldEkljtXZYb9zYJdE+CIxYPl/2enz2kHlisfCRpTOqtRN07Yp28xShncMya3TbOcpXaVrNHGInj66W4iYiiQU6rTyqUkKWLph+9nrMMLrl8uU+B6mXFHL7HGde024e4fpNOo0Up8dv+Xi4Qzr1mqvzQ1IHL8lnd8ikdsid7HJyvMf4QdrbmaI0EOsitlOlW2shVgRUqYVYllC6Ha4Hra1TAv2+UUSpRl0ocs/DOiaWa4faRYNPLzVst0zhrUDuN41CUiL7TOPypI3Xq37nlMcu5d4pjttiONJxPBGvJzEam/QHkXNU+oNovnT+tF19C5pYLH0UocJ4tuTu7pbs7j4n6RzF4zybzXa+TCYek2j+PsUp0dRzbJGb8ZjxeIDrmLiOjWNFNZown89itk92SiQbTWkw6N+wuV3TLF1Su6pyG1G7u+P2FsZj9+kMIy/btsBkOuPuboWpiHQFkfVdBBnDMr6x/x5gs5al1TihWEhxVkjFP0vVcobSxSfyx7tYTvPR7vwXgJntXClnyJ/sIYlnKPIlQivPRS6J7bafDPh/YDHXlSC6h2UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"joined table\"\n        title=\"joined table\"\n        src=\"/static/f5418ffabd6e82fc018f57c6021ddd7f/c540e/joined-table.png\"\n        srcset=\"/static/f5418ffabd6e82fc018f57c6021ddd7f/c26ae/joined-table.png 158w,\n/static/f5418ffabd6e82fc018f57c6021ddd7f/c540e/joined-table.png 191w\"\n        sizes=\"(max-width: 191px) 100vw, 191px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></li>\n</ul>\n<h1 id=\"querying-in-jpa\" style=\"position:relative;\"><a href=\"#querying-in-jpa\" aria-label=\"querying in jpa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Querying in JPA</h1>\n<ul>\n<li>using query dsl or domain specific language provides with query validity, as code will be checked at compile time</li>\n<li>the method name we write gets converted to jpql, which again gets converted to sql</li>\n<li>e.g. for and - <code class=\"language-text\">public List&lt;Speaker> findByFirstNameAndLastName(String firstName, String lastName);</code></li>\n<li>e.g. for equals - <code class=\"language-text\">findByLength</code>, <code class=\"language-text\">findByLengthIs</code>, <code class=\"language-text\">findByLengthEquals</code> all use the <code class=\"language-text\">=</code> symbol for comparison</li>\n<li>e.g. for not equals - <code class=\"language-text\">findByLengthNot</code> uses the <code class=\"language-text\">!=</code> symbol for comparison</li>\n<li>e.g. for like - <code class=\"language-text\">public List&lt;Session> findBySessionNameNotLike(String sessionName);</code>, but, we have to add the symbol manually, i.e. - <code class=\"language-text\">jpaRepository.findBySessionNameNotLike(\"Java%\");</code></li>\n<li>to add <code class=\"language-text\">%</code> automatically, use <code class=\"language-text\">StartingWith</code>, <code class=\"language-text\">EndingWith</code>, <code class=\"language-text\">Containing</code></li>\n<li>we can use <code class=\"language-text\">LessThan</code> for <code class=\"language-text\">&lt;</code>, <code class=\"language-text\">GreaterThanEqual</code> for <code class=\"language-text\">>=</code>, etc</li>\n<li>for dates, we can use <code class=\"language-text\">findByDateBefore</code>, <code class=\"language-text\">findByDateAfter</code>, <code class=\"language-text\">findByDateBetween</code></li>\n<li>we can use <code class=\"language-text\">In</code> and <code class=\"language-text\">NotIn</code> and pass collections as parameters</li>\n<li>we can make a typeahead by using <code class=\"language-text\">ContainingIgnoreCase</code></li>\n<li>to the end of the method name, we can add the order by clause. e.g. <code class=\"language-text\">findByLastNameOrderByFirstNameAsc</code></li>\n<li>limit results using - <code class=\"language-text\">findFirstByName</code>, <code class=\"language-text\">findTop5ByName</code></li>\n<li>jpql is useful for complex queries, dsl may not be possible or have extremely long method names</li>\n<li>joins are performed automatically when you reference a property with relationships</li>\n<li>e.g. -\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"select tp from TicketPrice tp \"</span> <span class=\"token operator\">+</span> \n  <span class=\"token string\">\"where tp.basePrice &lt; ?1 \"</span> <span class=\"token operator\">+</span> \n  <span class=\"token string\">\"and tp.ticketType.includesWorkshop = true\"</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TicketPrice</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getTicketsUnderPrice</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BigDecimal</span> price<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>sometimes we have fetch type as lazy, but we still want the join to happen in some case\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select s from Submission s join fetch s.question\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Submission</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllWithQuestion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>we can also use named parameters\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"select tp from TicketPrice tp \"</span> <span class=\"token operator\">+</span> \n  <span class=\"token string\">\"where tp.basePrice &lt; :maxPrice \"</span> <span class=\"token operator\">+</span> \n  <span class=\"token string\">\"and tp.ticketType.includesWorkshop = true\"</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TicketPrice</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getTicketsUnderPrice</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"maxPrice\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">BigDecimal</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>we can also set <code class=\"language-text\">nativeQuery = true</code> to write queries in the database language and not in jpql. however, by using this method, we get tied to the database itself</li>\n<li><code class=\"language-text\">@Modifying</code> can be used along with <code class=\"language-text\">@Query</code> if we want to update rows, the number of rows modified is returned in this case\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Modifying</span>\n<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"...\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>named queries e.g. (note: below is for <code class=\"language-text\">@NamedQuery</code>, we also have <code class=\"language-text\">@NamedNativeQuery</code>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@NamedQuery</span><span class=\"token punctuation\">(</span>\n  name <span class=\"token operator\">=</span> <span class=\"token string\">\"TicketPrice.namedFindTicketsByPricingCategoryName\"</span><span class=\"token punctuation\">,</span>\n  query <span class=\"token operator\">=</span> <span class=\"token string\">\"select tp from TicketPrice tp where tp.pricingCategory.pricingCategoryName = :name\"</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TicketPrice</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TicketPriceJpaRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TicketPrice</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TicketPrice</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">namedFindTicketsByPricingCategoryName</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>precedence in jpa repository i.e. how spring data jpa tries to resolve queries in case our code matches multiple formats - <code class=\"language-text\">@Query</code> > named query > query dsl</li>\n</ul>","frontmatter":{"title":"Spring Persistence"}}},"pageContext":{"id":"30896e2e-6c5f-59db-8d38-45cfee7e3a2f"}},"staticQueryHashes":["1037383464","1617985380"]}