{"componentChunkName":"component---src-templates-blog-js","path":"/docker/","result":{"data":{"markdownRemark":{"fields":{"slug":"/docker/"},"id":"3376581e-4756-5e76-8bc8-0d0d798b1c68","html":"<h1 id=\"about-docker\" style=\"position:relative;\"><a href=\"#about-docker\" aria-label=\"about docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About Docker</h1>\n<ul>\n<li>docker is a tool for managing containers</li>\n<li>container is a package of our code along with the dependencies and libraries to run that code</li>\n<li>docker follows a client server architecture\n<ul>\n<li>we issue commands via cli to the docker client</li>\n<li>all tasks like creating containers, pulling images, etc. is done by docker daemon (dockerd)</li>\n</ul>\n</li>\n<li>docker can be run natively in linux, so for macOS and windows, a virtualization layer is needed</li>\n<li>docker engine - dockerd, docker client</li>\n<li>docker desktop - docker engine, docker cli, kubernetes, docker compose, etc</li>\n</ul>\n<h1 id=\"why-use-docker\" style=\"position:relative;\"><a href=\"#why-use-docker\" aria-label=\"why use docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why use Docker</h1>\n<ul>\n<li>the same piece of code will always yield the same application i.e. doesn’t rely on host environment</li>\n<li>having similar development, staging and production environments</li>\n<li>easily manage different projects running different versions of dependencies</li>\n<li>easily switch between versions of dependencies</li>\n<li>virtual machines are not as easily reproducible as containers since they have their own dedicated OS</li>\n<li>sharing and distributing is very convenient using Dockerfile, image, etc</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 401px; margin: 5px 0 5px 0 !important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dbddbedaff4944de81d1ad98538cc892/9144d/docker-vs-vm.drawio.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVQ4y42T6Y7CMAyE8/4PV/hXAYJSrnKVs+UqrdFnaRB0V6u1FCVOnPGMnYT9fm/9ft96vZ4dj0fbbrfuM3a7nT2fT8OapvEZ//F4WFVVVtf1l886nM9nv5wkiRVFYSQYDAY2Ho/tdDp5IMZlbDabWRRF1ul0bLVa2XQ6db/b7fo6AMLlLMusLEs7HA5vn2QCFENUxHFsw+HQz1GBPxqNnExAIhuTycQ3yIpPNs7ETICAADafz10RBPAhQDKXvNlsPNPtdvMBUJ7nfhkgDQwQYgFSPEDscRZgRFEBSdPUmQqcGgIqUxwAxKGCQYnYu1wuFsgkKRR8uVy+QQAgq4x64pMMicSSAFDAUBFgAzqB1+vVD9Qcaqpno06zB3PFMliD4U2hfiygLcms2SPJp2QYUlvGZzxPjniAg7LRtcVi4VKY2QOgDUgSFPwW/yVZ9P8j+a/4sF6vHZ2GSALFJhB2bYY0gbN2PKDeZVChqkdNTckGm/v9/gOQEmHteDDefxkJKjYM9Naol36KfgvxqGJQLu4Aik+yoMwUmfeEDGb9YQHpp2A0gr/LLOncx14yc3e1VE0gQQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker vs vm\"\n        title=\"docker vs vm\"\n        src=\"/static/dbddbedaff4944de81d1ad98538cc892/9144d/docker-vs-vm.drawio.png\"\n        srcset=\"/static/dbddbedaff4944de81d1ad98538cc892/c26ae/docker-vs-vm.drawio.png 158w,\n/static/dbddbedaff4944de81d1ad98538cc892/6bdcf/docker-vs-vm.drawio.png 315w,\n/static/dbddbedaff4944de81d1ad98538cc892/9144d/docker-vs-vm.drawio.png 401w\"\n        sizes=\"(max-width: 401px) 100vw, 401px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"images-and-containers\" style=\"position:relative;\"><a href=\"#images-and-containers\" aria-label=\"images and containers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Images and Containers</h1>\n<ul>\n<li>images are templates for containers, and a container is a running instance of an image</li>\n<li>containers are lightweight, isolated and run independent of each other</li>\n<li>we can use official prebuilt images, the most common source is <a href=\"https://hub.docker.com\">docker hub</a></li>\n<li>note: while issuing docker commands\n<ul>\n<li>container name and container id can be used interchangeably, same for image</li>\n<li>first few characters of the image_id are enough to reference the image if they can uniquely identify it</li>\n</ul>\n</li>\n<li><code class=\"language-text\">docker container run image_name</code> to create a container from an image</li>\n<li>if the image is not available locally, it is downloaded from dockerhub by docker</li>\n<li><code class=\"language-text\">docker container ls</code> to list all running containers\n<ul>\n<li><code class=\"language-text\">docker container ls -a</code> to list all running as well as stopped containers</li>\n</ul>\n</li>\n<li>Dockerfile is a special file name, as it is the default file docker looks for when we build an image</li>\n<li>Dockerfile contains the instructions for creating our own image</li>\n<li>example of a Dockerfile\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:14-alpine</span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /app</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . .</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install</span>\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 80</span>\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> npm run start</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>all commands except the last instruction <code class=\"language-text\">CMD</code> are used to build the image, <code class=\"language-text\">CMD</code> is used to run the container</li>\n<li><code class=\"language-text\">EXPOSE</code> is only for documentation purpose</li>\n<li><code class=\"language-text\">docker image build .</code> - used to build an image using the Dockerfile, <code class=\"language-text\">.</code> here is the build context\n<ul>\n<li><code class=\"language-text\">-t</code> flag to specify an image tag</li>\n</ul>\n</li>\n<li>images have layers i.e. docker caches result after every instruction in the Dockerfile</li>\n<li>this means docker can reuse layers if possible</li>\n<li>so, to optimize i.e. make building of images faster, in the Dockerfile example shown earlier, we can first install dependencies and then copy the source code, as rebuilding of image will be triggered more frequently by a change in the source code than it will be by a change in the dependencies\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:14-alpine</span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /app</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> package.json .</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . .</span>\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 80</span>\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> npm run start</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li><code class=\"language-text\">docker container start container_id</code> - start a stopped container</li>\n<li>we can reattach our terminal to the container using <code class=\"language-text\">docker container attach container_id</code></li>\n<li>we can view logs using <code class=\"language-text\">docker container logs container_id</code>\n<ul>\n<li>add <code class=\"language-text\">-f</code> flag for following the logs</li>\n</ul>\n</li>\n<li>flags for <code class=\"language-text\">docker container run</code> -\n<ul>\n<li><code class=\"language-text\">-it</code> can be used to enter interactive mode</li>\n<li><code class=\"language-text\">--rm</code> flag to delete the container when we stop it</li>\n<li><code class=\"language-text\">--name</code> to specify the name of container</li>\n<li><code class=\"language-text\">-d</code> to run in detached mode i.e. to not block our current terminal and run the container in foreground</li>\n<li><code class=\"language-text\">-p</code> flag means publish, i.e. map host port to a container port</li>\n</ul>\n</li>\n<li><code class=\"language-text\">docker image ls</code> - lists the downloaded images</li>\n<li><code class=\"language-text\">docker image rm image_id</code> - remove the image with id image_id</li>\n<li><code class=\"language-text\">docker container stop container_id</code> - stop the container</li>\n<li><code class=\"language-text\">docker container prune</code> to delete all stopped containers</li>\n<li>to get more information on images and containers, use <code class=\"language-text\">docker container inspect container_id</code><br>\nand <code class=\"language-text\">docker image inspect image_id</code></li>\n<li><code class=\"language-text\">docker container cp host_folder container_id:folder</code> to copy folder from the host to the container\n<ul>\n<li>we can also reverse the order of arguments to copy folders and files from the container to the host</li>\n</ul>\n</li>\n<li>we can share images, by sharing the Dockerfile or by hosting it on an image registry like docker hub</li>\n<li><code class=\"language-text\">docker image push image_name:tag</code> to push images to the registry</li>\n<li><code class=\"language-text\">docker image pull image_name:tag</code> to pull images from the registry</li>\n<li>we can also tag images using <code class=\"language-text\">docker image tag new_image_name old_image_name</code></li>\n<li>a full example of running a container - <code class=\"language-text\">docker container run -d -p 3000:80 --name=backend --rm backend</code></li>\n<li><code class=\"language-text\">docker login</code> to login to docker hub</li>\n<li>note: I had to use a token instead of the docker hub password since I am using MFA</li>\n<li><code class=\"language-text\">docker image rm -f $(docker image ls -a -q)</code> - deletes all locally downloaded images\n<ul>\n<li><code class=\"language-text\">-q</code> helps list only image ids</li>\n<li><code class=\"language-text\">-a</code> helps list intermediate images as well</li>\n<li><code class=\"language-text\">-f</code> force removal, e.g. if image is referenced by another image</li>\n</ul>\n</li>\n<li>we can use a file <code class=\"language-text\">.dockerignore</code> to prevent copying files when using command <code class=\"language-text\">COPY</code> inside the Dockerfile e.g.\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">node_modules\nDockerfile\n.git</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id=\"tags\" style=\"position:relative;\"><a href=\"#tags\" aria-label=\"tags permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tags</h1>\n<ul>\n<li>an image tag has two parts - the name / repository of the image and the tag</li>\n<li>tag is like a version, so we can generate different versions of our image</li>\n<li>the default tag if not specified is latest</li>\n<li>why tags are important -\n<ul>\n<li>rollback to previous versions in the production environment if newer versions have a bug</li>\n<li>newer versions of other images which are used by our images might have breaking changes in future</li>\n</ul>\n</li>\n<li>suppose we always push and pull using tag latest. when we run <code class=\"language-text\">docker container run...</code>, it looks for the image locally and if it doesn’t find it, it goes online to fetch it. but it will find the image with the tag latest, and docker doesn’t understand that someone else has pushed a newer version online</li>\n</ul>\n<h1 id=\"layered-architecture\" style=\"position:relative;\"><a href=\"#layered-architecture\" aria-label=\"layered architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Layered Architecture</h1>\n<ul>\n<li>all the docker related data like images, containers, etc. can be seen in /var/lib/docker</li>\n<li>the doker image we build contains of layers, and these layers are shared across various images</li>\n<li>e.g. if two images use the same base image, the layer of the base image is shared</li>\n<li>the image layers are read only</li>\n<li>when we create a container, a new layer is created on top of the existing layers of the image</li>\n<li>thus, all writes that we perform during runtime, log files, etc. get written onto this layer</li>\n<li>the persistence during the container’s lifetime happens through this writable layer</li>\n<li>this mechanism is called copy on write, and the changes we made are lost unless we use volumes</li>\n</ul>\n<h1 id=\"volumes\" style=\"position:relative;\"><a href=\"#volumes\" aria-label=\"volumes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Volumes</h1>\n<ul>\n<li>containers should be stateless as they can be easily created and destroyed, scaled up and down</li>\n<li>we can have data that we want to persist even if containers are killed</li>\n<li>this data shouldn’t be stored inside containers, or we may lose that data</li>\n<li>volumes - mapping a persistent storage to docker containers. the persistent storage can be cloud storage<br>\ne.g. s3 of aws or our host directory system</li>\n<li>this way, every time a container tries to persist changes, they go to the persistent storage and don’t get lost irrespective of how many times the container is started or stopped</li>\n<li>volumes can be of three types -\n<ul>\n<li>anonymous volumes</li>\n<li>named volumes</li>\n<li>bind mounts</li>\n</ul>\n</li>\n<li><code class=\"language-text\">docker volume ls</code> shows all volumes</li>\n<li>anonymous volumes are managed by docker</li>\n<li>the <strong>reference</strong> to anonymous volumes are lost after the container shuts down</li>\n<li>if we use <code class=\"language-text\">--rm</code> flag while running the container, the anonymous volume is deleted as well</li>\n<li>we can create anonymous volume by using <code class=\"language-text\">VOLUME ./feedback</code> inside the Dockerfile</li>\n<li>we can also create anonymous volume by using flag <code class=\"language-text\">-v /a/b</code> during <code class=\"language-text\">docker container run</code> where /a/b is the path inside the container</li>\n<li>named volumes are managed by docker too</li>\n<li>unlike anonymous volumes, we don’t lose the reference to named volumes after the container is deleted</li>\n<li>use flag <code class=\"language-text\">-v</code> to create named volumes, e.g. <code class=\"language-text\">-v feedback:/app/feedback</code>, where the name of the volume is feedback and the directory of the container it maps to is <code class=\"language-text\">/app/feedback</code></li>\n<li>bind mounts are managed by us. it can be used for source code, so that the changes that we make to the code get reflected in the container</li>\n<li>in case of bind mounts, we have access to the folder which gets mapped to the container’s folder</li>\n<li>in case of clashes, the more specific paths win e.g. if we are using bind mounts for /app of container and anonymous volumes for /app/node_modules of container, /app/node_modules relies on anonymous volumes</li>\n<li>using nodemon with bind mounts prevents us from rebuilding images repeatedly i.e. our changes in source code are accounted for in the running container</li>\n<li>we can use suffix <code class=\"language-text\">:ro</code> so that it specifies to the container that the volume is read only e.g. <code class=\"language-text\">-v $(pwd)/app:ro</code>, so that only hosts and not containers can edit the source code</li>\n<li>note: <code class=\"language-text\">docker volume ls</code> will not list bind mount volumes, since it doesn’t manage them</li>\n<li><code class=\"language-text\">docker volume rm volume_name</code> to remove volumes</li>\n<li><code class=\"language-text\">docker volume prune</code> to remove volumes not being used by any containers</li>\n<li><code class=\"language-text\">docker volume inspect volume_name</code> to get details of the volume</li>\n</ul>\n<h1 id=\"arguments-and-environment-variables\" style=\"position:relative;\"><a href=\"#arguments-and-environment-variables\" aria-label=\"arguments and environment variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arguments and Environment Variables</h1>\n<ul>\n<li>docker supports build time arguments and runtime environment variables</li>\n<li>runtime environment variables can be provided using <code class=\"language-text\">ENV PORT 80</code> inside the Dockerfile</li>\n<li>we can also provide it dynamically using <code class=\"language-text\">-e PORT=80</code>, which makes the earlier method a default</li>\n<li>for situations like api keys where security is a concern, the method suggested above is better</li>\n<li>we can also use build arguments, i.e. dynamic variables used when building an image</li>\n<li>can be done using <code class=\"language-text\">ARG PORT=80</code> in the Dockerfile</li>\n</ul>\n<h3 id=\"example\" style=\"position:relative;\"><a href=\"#example\" aria-label=\"example permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example</h3>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">ARG</span> DEFAULT_PORT=80</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> PORT <span class=\"token variable\">$DEFAULT_PORT</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> <span class=\"token variable\">$PORT</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>we are giving the value of the build argument to the environment variable</li>\n<li>if we don’t provide a port, the port used by container is <code class=\"language-text\">80</code></li>\n<li>now, we can change the default port while building an image using <code class=\"language-text\">docker image build ... --build-arg DEFAULT_PORT=9999 ...</code></li>\n<li>we can also receive a dynamic port using <code class=\"language-text\">docker container run ... -e PORT=9545 ...</code></li>\n<li>if we don’t provide a port dynamically, the port specified for building of images gets used</li>\n</ul>\n<h1 id=\"networks\" style=\"position:relative;\"><a href=\"#networks\" aria-label=\"networks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Networks</h1>\n<ul>\n<li>there are three kinds of entities with which containers can communicate -\n<ul>\n<li>internet</li>\n<li>host</li>\n<li>other containers</li>\n</ul>\n</li>\n<li>containers can by default talk to the internet e.g. a public api</li>\n<li>for containers to talk to the host, we can replace localhost by <code class=\"language-text\">host.docker.internal</code></li>\n<li>e.g. for containers to talk to mongodb running on our host machine, we can use <code class=\"language-text\">mongodb://host.docker.internal:27017/favorites</code></li>\n<li>for containers to talk to other containers, we can use <code class=\"language-text\">docker container inspect ...</code> to get the container’s ip address (available in the key IPAddress) and then use it. e.g. with a mongodb container running, we run <code class=\"language-text\">docker container inspect mongodb</code> and then use <code class=\"language-text\">mongodb://the_ip_address:27017/favorites</code></li>\n<li>this is not ideal, as this IP could change after a new container replaces the old one</li>\n<li>we can create a docker network, and all containers placed inside the network can reference each other directly using the container names, e.g. <code class=\"language-text\">mongodb://mongodb_container_name:27017/favorites</code></li>\n<li><code class=\"language-text\">docker network create network_name</code> to create a network</li>\n<li><code class=\"language-text\">docker container run ... --network=network_name ...</code> to create a container inside a specific network</li>\n<li>also, we don’t need <code class=\"language-text\">-p</code> for the container to which another container connects, i.e. <code class=\"language-text\">-p</code> is only needed when we want our host port to map to the container port, not when another container wants to communicate with it</li>\n<li>docker networks support different kinds of drivers. the default driver is bridge, which we saw above</li>\n<li>there can be other types of drivers and third party plugins for drivers as well</li>\n<li>we can use driver as “host” so that isolation between the container’s network and localhost is removed</li>\n<li>examples of usage - <code class=\"language-text\">docker network create --driver bridge</code> or <code class=\"language-text\">docker container run --network host</code></li>\n<li>we can clean up unused networks using <code class=\"language-text\">docker network prune</code></li>\n<li>the bridge type of network uses <a href=\"/the-tcp-ip-model/#network-namespaces\">network namespaces</a> behind the scenes. so, on running <code class=\"language-text\">ip addr</code>, we see docker0, which is basically the virtual switch in network namespaces. each container is encapsulated inside its own network namespace. an e.g. is shown below -\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token function\">docker</span> container run nginx\n<span class=\"token function\">docker</span> container inspect <span class=\"token operator\">&lt;&lt;</span>container_name<span class=\"token operator\">>></span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{ .NetworkSettings.SandboxKey }}\"</span>\n<span class=\"token comment\"># the output is /var/run/docker/netns/&lt;&lt;namespace-name>></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id=\"docker-compose\" style=\"position:relative;\"><a href=\"#docker-compose\" aria-label=\"docker compose permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Compose</h1>\n<ul>\n<li>docker compose helps in preventing having to run docker commands from cli repeatedly</li>\n<li>it has syntax in yml which is easier to read and can be shipped with our code</li>\n<li>services in docker compose are containers, for which we can define environment variables, network, image, etc</li>\n<li>version of docker compose I had to use was 3.8 based on my <a href=\"https://docs.docker.com/compose/compose-file/\">docker engine version</a></li>\n<li>all container names are one level nested under the services key</li>\n<li>can specify networks, volumes key for each container</li>\n<li>for named volumes, we should also mention them under the volumes key in the root of the file</li>\n<li>all the containers are a part of the default network created by docker-compose</li>\n<li><code class=\"language-text\">docker-compose up</code> starts all the containers and builds the images as well\n<ul>\n<li>flag <code class=\"language-text\">-d</code> can be used to start in detached mode</li>\n<li>add flag <code class=\"language-text\">--build</code> to force the images to be rebuilt</li>\n</ul>\n</li>\n<li><code class=\"language-text\">docker-compose down</code> - deletes all the containers and the default network that docker-compose creates\n<ul>\n<li>flag <code class=\"language-text\">-v</code> also removes the volumes which were created</li>\n</ul>\n</li>\n<li>use <code class=\"language-text\">depends_on</code> key to ensure the order in which containers start e.g. server <code class=\"language-text\">depends_on</code> mongodb container</li>\n<li><code class=\"language-text\">docker-compose build</code> to build the images</li>\n<li><code class=\"language-text\">docker-compose run service_name</code> to run a specific container in the compose file under the services key</li>\n</ul>\n<h1 id=\"issues-while-containerizing-frontend-apps\" style=\"position:relative;\"><a href=\"#issues-while-containerizing-frontend-apps\" aria-label=\"issues while containerizing frontend apps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Issues while Containerizing Frontend Apps</h1>\n<ul>\n<li>docker doesn’t work in the web browser for e.g. when we make xhr requests\n<ul>\n<li>so referring the backend application just by container name won’t work as it utilizes docker networks</li>\n<li>so, we publish the backend on a host port and simply use localhost:that_port in frontend</li>\n</ul>\n</li>\n<li>reactJS needs the terminal to be in interactive mode to ensure it continues to run\n<ul>\n<li>it is like adding <code class=\"language-text\">-it</code> flag while using <code class=\"language-text\">docker container run...</code>, or setting <code class=\"language-text\">stdin_open: true</code> and <code class=\"language-text\">tty: true</code> inside of the docker compose</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"cmd-and-entrypoint\" style=\"position:relative;\"><a href=\"#cmd-and-entrypoint\" aria-label=\"cmd and entrypoint permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CMD and ENTRYPOINT</h1>\n<ul>\n<li>when we specify <code class=\"language-text\">docker container run image_name xyz</code>, xyz replaces what there is in CMD</li>\n<li>however xyz appends what is there in ENTRYPOINT</li>\n<li>we can replace what is there in ENTRYPOINT using <code class=\"language-text\">--entrypoint</code></li>\n<li>useful tip - since a space separated command needs to be a part of different items in an array, use <code class=\"language-text\">sh -c</code>. i.e. <code class=\"language-text\">CMD [\"a\", \"b\", \"c\"]</code> can become <code class=\"language-text\">CMD [\"sh\", \"-c\", \"a b c\"]</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> ubuntu</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> [ <span class=\"token string\">\"sleep\"</span> ]</span>\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [ <span class=\"token string\">\"10\"</span> ]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li><code class=\"language-text\">docker image build -t ubuntu-sleeper .</code></li>\n<li>run <code class=\"language-text\">docker container run ubuntu-sleeper</code>, sleep is of 10 seconds</li>\n<li>run <code class=\"language-text\">docker container run ubuntu-sleeper 20</code>, sleep is of 20 seconds</li>\n<li>run <code class=\"language-text\">docker container run -it --entrypoint=bash ubuntu-sleeper</code>, run bash in interactive mode</li>\n</ul>\n<h1 id=\"setup-containers\" style=\"position:relative;\"><a href=\"#setup-containers\" aria-label=\"setup containers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup Containers</h1>\n<p>how do we set up initial project e.g. how to run <code class=\"language-text\">npm init</code> when we don’t have node installed locally? below is an example for setup using node</p>\n<p>Dockerfile.setup -</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:14-alpine</span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /app</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>docker-compose-setup.yml -</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">npm</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> ./\n      <span class=\"token key atrule\">dockerfile</span><span class=\"token punctuation\">:</span> Dockerfile.setup\n    <span class=\"token key atrule\">stdin_open</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">tty</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./<span class=\"token punctuation\">:</span>/app\n    <span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> npm</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>now, we can use commands to help during development like -</p>\n<ul>\n<li><code class=\"language-text\">docker-compose -f docker-compose-setup.yml run npm init</code></li>\n<li><code class=\"language-text\">docker-compose -f docker-compose-setup.yml run npm i express</code></li>\n</ul>\n<p>the <code class=\"language-text\">npm</code> in the command is the service name inside docker compose, and entrypoint was given as npm in docker-compose, otherwise we would have to run <code class=\"language-text\">docker-compose -f docker-compose-setup.yml run npm npm init</code></p>","frontmatter":{"title":"Docker"}}},"pageContext":{"id":"3376581e-4756-5e76-8bc8-0d0d798b1c68"}},"staticQueryHashes":["1037383464","1617985380"]}