{"componentChunkName":"component---src-templates-blog-js","path":"/gitlab-ci-cd/","result":{"data":{"markdownRemark":{"fields":{"slug":"/gitlab-ci-cd/"},"id":"cf4a747e-58d7-5f66-8075-5501f169ab11","html":"<h1 id=\"cicd\" style=\"position:relative;\"><a href=\"#cicd\" aria-label=\"cicd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CI/CD</h1>\n<ul>\n<li><strong>continuous integration</strong> - code gets tested and built every time we push to get continuous feedback</li>\n<li><strong>continuous delivery</strong> - some manual intervention is needed to install it into servers</li>\n<li><strong>continuous deployment</strong> - a step beyond continuous delivery, using which we deploy to servers automatically</li>\n<li>building, unit and integration tests come under ci and reviews, deployment to staging and production under cd</li>\n</ul>\n<h1 id=\"architecture\" style=\"position:relative;\"><a href=\"#architecture\" aria-label=\"architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Architecture</h1>\n<ul>\n<li>pipelines are written in .gitlab-ci.yml unless configured otherwise</li>\n<li>gitlab runner is the tool used by gitlab to run the pipeline</li>\n<li>gitlab servers schedule the pipelines on gitlab runners</li>\n<li>this architecture allows for the horizontal scaling of runners</li>\n<li>by default, shared runners available for the saas version of gitlab, <a href=\"https://about.gitlab.com/pricing/\">with a limit of 400 minutes a month</a></li>\n<li>we can use tags to run a job on a specific type of runner, e.g. some job needs to be run on a windows os</li>\n<li>any runner with all the job tags is eligible to run that specific job\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">job-name</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ruby\n    <span class=\"token punctuation\">-</span> test</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>executors - the way the jobs are run by the runner. some of them are -\n<ul>\n<li>shell - run on the vm itself</li>\n<li>docker - run inside a docker container</li>\n<li>kubernetes - run as a pod in a k8s cluster</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"jobs-and-stages\" style=\"position:relative;\"><a href=\"#jobs-and-stages\" aria-label=\"jobs and stages permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jobs and Stages</h1>\n<ul>\n<li>jobs are the unit of work in gitlab pipelines</li>\n<li>the order to execute the different jobs in can be defined via stages</li>\n<li>stages run in a sequential order</li>\n<li>jobs in the same stage run in parallel</li>\n<li>jobs of stage x + 1 start executing only when all jobs of stage x are over and successful by default</li>\n<li>we can retry a job / pipeline if it fails, using the retry icon in ui</li>\n</ul>\n<h1 id=\"image\" style=\"position:relative;\"><a href=\"#image\" aria-label=\"image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Image</h1>\n<ul>\n<li>gitlab uses docker to execute pipelines</li>\n<li>by default, gitlab pipelines use the image ruby:2.5</li>\n<li>we can set a default image at the yml root so that unless specified otherwise, all jobs use this image</li>\n<li>syntax - <code class=\"language-text\">image: node:16-alpine</code></li>\n<li>gitlab has its own container registry, which is an alternative to docker hub, ecr, etc</li>\n<li>using gitlab’s container registry reduces network latency</li>\n<li>gitlab also has its own package repository for maven, npm, etc</li>\n</ul>\n<h1 id=\"methods-of-triggering-a-pipeline\" style=\"position:relative;\"><a href=\"#methods-of-triggering-a-pipeline\" aria-label=\"methods of triggering a pipeline permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Methods of Triggering a Pipeline</h1>\n<ul>\n<li>a push to the codebase</li>\n<li>we can also manually trigger a pipeline run by clicking on “run pipeline” under ci/cd -> pipelines. we get a chance to override the variables if we want for that particular run</li>\n<li>we can have scheduled pipelines, e.g. perform health check on production website every 2 hours</li>\n<li>we can trigger them via upstream pipelines i.e. a pipeline triggers another pipeline\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> test\n  <span class=\"token key atrule\">trigger</span><span class=\"token punctuation\">:</span> group/project</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>by making api calls to gitlab</li>\n</ul>\n<h1 id=\"using-command-line\" style=\"position:relative;\"><a href=\"#using-command-line\" aria-label=\"using command line permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Command Line</h1>\n<ul>\n<li>if a command returns 0, gitlab considers the command to have passed</li>\n<li>if a command returns 1-255, it is considered to have failed, which in turn marks the job as failed</li>\n<li><code class=\"language-text\">echo $?</code> can display the return code by the last command</li>\n<li>pipe operator can be used to pipe output of cmd1 to cmd2 - <code class=\"language-text\">cmd1 | cmd2</code></li>\n<li>some commands run perennially e.g. <code class=\"language-text\">npm run serve</code>, which can block the command line of the job\n<ul>\n<li>suffix with <code class=\"language-text\">&amp;</code>, e.g. <code class=\"language-text\">npm run serve &amp;</code> to run it in background</li>\n<li>add a sleep e.g. <code class=\"language-text\">sleep 5</code> to allow for the server to have started properly</li>\n<li><a href=\"https://stackoverflow.com/a/28879552/11885333\">why <code class=\"language-text\">tac</code> was needed</a>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> npm run serve &amp;\n  <span class=\"token punctuation\">-</span> sleep 5\n  <span class=\"token punctuation\">-</span> curl http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>9000 <span class=\"token punctuation\">|</span> tac <span class=\"token punctuation\">|</span> tac <span class=\"token punctuation\">|</span> grep <span class=\"token punctuation\">-</span>q \"Gatsby\"</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n</li>\n<li>sed is used to replace strings in templates. e.g. to replace <code class=\"language-text\">%%VERSION%%</code> from html footer, use <code class=\"language-text\">sed -i \"s/%%VERSION%%/$CI_COMMIT_SHORT_SHA/\" ./index.html</code></li>\n<li><code class=\"language-text\">jq</code> is used for json related parsing in command line</li>\n<li>we also have <code class=\"language-text\">before_script</code> and <code class=\"language-text\">after_script</code>, which can be defined at global / job level. it is just for semantic purpose and refactoring code</li>\n</ul>\n<h1 id=\"artifacts\" style=\"position:relative;\"><a href=\"#artifacts\" aria-label=\"artifacts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Artifacts</h1>\n<ul>\n<li>the jobs run independent of one another, so to share data between them, we use artifacts</li>\n<li>we can view / download the artifacts from the pipeline runs</li>\n<li>we can configure as to when the artifacts should be expired</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># ...</span>\n  <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> public/\n    <span class=\"token key atrule\">expire_in</span><span class=\"token punctuation\">:</span> 1 day</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id=\"cache\" style=\"position:relative;\"><a href=\"#cache\" aria-label=\"cache permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache</h1>\n<ul>\n<li>since jobs run isolated, we can cache for e.g. external project dependencies</li>\n<li>we specify a key for the cache and the path to cache</li>\n<li>key can be files as well e.g. package-lock.json</li>\n<li>we can specify this at the root level as well</li>\n<li>gitlab jobs will have logs like <code class=\"language-text\">failed to extract cache</code>, <code class=\"language-text\">successfully extracted cache</code>, etc\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">files</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> package<span class=\"token punctuation\">-</span>lock.json\n  <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> node_modules</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>there are more considerations like for e.g. where does the cache go. we can have the cache go to the runner itself and not the server or some other place to optimize latency. for this, we might have to use tags to ensure that the jobs get picked up by the same runner</li>\n<li>we can use one runner and the cache is stored in that runner</li>\n<li>we can also use multiple runners with distributed caching e.g. s3</li>\n</ul>\n<h1 id=\"environment-variables\" style=\"position:relative;\"><a href=\"#environment-variables\" aria-label=\"environment variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Environment Variables</h1>\n<h3 id=\"custom\" style=\"position:relative;\"><a href=\"#custom\" aria-label=\"custom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custom</h3>\n<ul>\n<li>settings -> ci/cd -> variables</li>\n<li>these are environment variables available to jobs</li>\n<li>we can mask them, which means gitlab will try hiding them from job logs</li>\n<li>we can protect them, which means these variables would only be available to protected branches and tags</li>\n</ul>\n<h3 id=\"predefined\" style=\"position:relative;\"><a href=\"#predefined\" aria-label=\"predefined permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Predefined</h3>\n<ul>\n<li>predefined variables accessible in jobs have been listed <a href=\"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html\">here</a></li>\n<li>a common use case - tag docker images which are being built and pushed with commit hash</li>\n</ul>\n<h3 id=\"in-pipelines\" style=\"position:relative;\"><a href=\"#in-pipelines\" aria-label=\"in pipelines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>In Pipelines</h3>\n<p>we can use the <code class=\"language-text\">variables</code> key - either at the pipeline or at the job level to define variables</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">IMAGE_REPOSITORY</span><span class=\"token punctuation\">:</span> $ECR_REPOSITORY<span class=\"token punctuation\">:</span>$CI_COMMIT_HASH</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h1 id=\"environments\" style=\"position:relative;\"><a href=\"#environments\" aria-label=\"environments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Environments</h1>\n<ul>\n<li>we can add environments to the job</li>\n<li>it adds stuff to the gitlab ui like merge requests</li>\n<li>from the sidebar, deployments -> environments</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">deploy staging</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># ...</span>\n  <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> staging\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> $STAGING_DOMAIN</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id=\"gitlab-configuration\" style=\"position:relative;\"><a href=\"#gitlab-configuration\" aria-label=\"gitlab configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gitlab Configuration</h1>\n<ul>\n<li>uncheck this option - settings -> ci/cd -> general pipelines -> public pipelines</li>\n<li>switch this to only project members - settings -> general -> visibility, project features, permissions -> ci/cd</li>\n<li>check this option - settings -> general -> merge requests -> merge checks -> pipelines must succeed</li>\n<li>i like to have a stable production and staging enviornment, so i configure the following in settings -> repository -> protected branches -\n<ul>\n<li>maintainers can push (even force push) and merge to staging - rationale was to allow removing commits which are not ready for production, which was realized after testing in the staging environment</li>\n<li>no one can push to main and maintainers can merge to main</li>\n</ul>\n</li>\n<li>i use rebase, so i select fast-forward merge from settings -> general -> merge requests</li>\n</ul>\n<h1 id=\"manual-triggering\" style=\"position:relative;\"><a href=\"#manual-triggering\" aria-label=\"manual triggering permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Manual Triggering</h1>\n<ul>\n<li>we can have a manual play button to run a job which continues the pipeline</li>\n<li>use case - continuous deployment</li>\n<li>the job <code class=\"language-text\">b</code> would be stalled while jobs of future stages continue to run -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">b</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> b\n  <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> manual</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\nthe “fix”, depending on the behavior we want, is to use <code class=\"language-text\">allow_failure</code>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">b</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> b\n  <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> manual\n  <span class=\"token key atrule\">allow_failure</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>using the newer <code class=\"language-text\">rules</code> method, it would behave like the second configuration above\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> manual</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id=\"yaml-anchors\" style=\"position:relative;\"><a href=\"#yaml-anchors\" aria-label=\"yaml anchors permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>YAML Anchors</h1>\n<ul>\n<li><code class=\"language-text\">&amp; anchor_name</code> is used for anchor source</li>\n<li>for examples below, use <a href=\"https://onlineyamltools.com/convert-yaml-to-json\">any tool</a> to see equivalent json</li>\n<li><code class=\"language-text\">just *anchor_name</code> is used to use the anchor as is\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">person</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">first_name</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;name</span> john\n  <span class=\"token key atrule\">last_name</span><span class=\"token punctuation\">:</span> doe\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*name</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li><code class=\"language-text\">&lt;&lt;: *anchor_name</code> is used for destructuring anchor. merging nested properties and overriding them is allowed\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">person_one</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;doe_twins</span>\n  <span class=\"token key atrule\">first_name</span><span class=\"token punctuation\">:</span> john\n  <span class=\"token key atrule\">last_name</span><span class=\"token punctuation\">:</span> doe\n  <span class=\"token key atrule\">age</span><span class=\"token punctuation\">:</span> <span class=\"token number\">14</span>\n\n<span class=\"token key atrule\">person_two</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*doe_twins</span>\n  <span class=\"token key atrule\">first_name</span><span class=\"token punctuation\">:</span> jane</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id=\"reusing-job-configuration\" style=\"position:relative;\"><a href=\"#reusing-job-configuration\" aria-label=\"reusing job configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reusing Job Configuration</h1>\n<ul>\n<li>we can use gitlab’s pipeline editor. from the sidebar on right, we can navigate to ci/cd -> editor. we can copy our pipeline files to the editor for linting and visualizing them</li>\n<li>e.g. using yml anchors for reusing job config -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">.deploy-template</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;deploy</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> npm install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>global surge\n    <span class=\"token punctuation\">-</span> surge <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>project ./public <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>domain $DOMAIN\n  <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> $DOMAIN\n\n<span class=\"token key atrule\">deploy staging</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> deploy staging\n  <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*deploy</span>\n  <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">DOMAIN</span><span class=\"token punctuation\">:</span> $STAGING_DOMAIN\n\n<span class=\"token key atrule\">deploy production</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> deploy production\n  <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*deploy</span>\n  <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">DOMAIN</span><span class=\"token punctuation\">:</span> $PRODUCTION_DOMAIN\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> manual</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>when we prefix a job with <code class=\"language-text\">.</code> it is ignored by gitlab pipelines</li>\n<li>so, another way is to use the <code class=\"language-text\">extends</code> keyword. refactoring the above example -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">.deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> npm install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>global surge\n    <span class=\"token punctuation\">-</span> surge <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>project ./public <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>domain $DOMAIN\n<span class=\"token comment\"># ...</span>\n<span class=\"token key atrule\">deploy staging</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> .deploy\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> deploy staging\n<span class=\"token comment\"># ...</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>we can also extend <a href=\"https://docs.gitlab.com/ee/ci/yaml/yaml_optimization.html#merge-details\">multiple jobs</a></li>\n</ul>\n<h1 id=\"templates\" style=\"position:relative;\"><a href=\"#templates\" aria-label=\"templates permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Templates</h1>\n<ul>\n<li>we can use built in templates in our pipelines, e.g. <a href=\"https://docs.gitlab.com/ee/topics/autodevops/\">auto devops</a> includes features like container scanning, vulnerabilities, license issues, etc\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span> Auto<span class=\"token punctuation\">-</span>Devops.gitlab<span class=\"token punctuation\">-</span>ci.yml</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>to use a yml file from the project itself e.g. - microservices with monorepo, we can use -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> .gitlab<span class=\"token punctuation\">-</span>ci.common.yml</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id=\"services\" style=\"position:relative;\"><a href=\"#services\" aria-label=\"services permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Services</h1>\n<ul>\n<li>we can run services e.g. a postgres in the background for running tests. e.g.\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> tutum/wordpress<span class=\"token punctuation\">:</span>latest</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>the service can be accessed under two host names - <code class=\"language-text\">tutum__wordpress</code> and <code class=\"language-text\">tutum-wordpress</code></li>\n<li>we can <a href=\"https://docs.gitlab.com/ee/ci/services/#available-settings-for-services\">configure</a> <code class=\"language-text\">name</code>, <code class=\"language-text\">alias</code>, <code class=\"language-text\">command</code>, <code class=\"language-text\">entrypoint</code> and <code class=\"language-text\">variables</code> for each service</li>\n</ul>\n<h1 id=\"conditionally-running-jobs\" style=\"position:relative;\"><a href=\"#conditionally-running-jobs\" aria-label=\"conditionally running jobs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conditionally Running Jobs</h1>\n<ul>\n<li>pipelines can be triggered on different events like new commits, new tags, merge requests, etc</li>\n<li><code class=\"language-text\">only</code> and <code class=\"language-text\">except</code> are predecessors of <code class=\"language-text\">rules</code></li>\n<li>e.g. below of triggering a job on all branches except main\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> branches\n<span class=\"token key atrule\">except</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> main</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>the same thing written using rules -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_BRANCH == 'main'\n    <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> never\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> always</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>we can run a job only when changes are there in a specific directory\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">changes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> Dockerfile</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>we should address inefficient cases like 2 pipelines are created on creating a merge request</li>\n<li>operators operate on variables, like <code class=\"language-text\">==</code>, <code class=\"language-text\">=~</code> for regexp, etc</li>\n<li>in a rule, we set <code class=\"language-text\">allow_failure: true</code> so that the pipeline would pass even if the job fails</li>\n<li>the different values when can take - <code class=\"language-text\">manual</code>, <code class=\"language-text\">never</code>, <code class=\"language-text\">always</code>, <code class=\"language-text\">on_success</code> (when all jobs from all prior stages pass), <code class=\"language-text\">on_failure</code> (when one job from any prior stage fails), <code class=\"language-text\">delayed</code> (run after time set in <code class=\"language-text\">start_in</code>)</li>\n<li>summing up the syntax -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_BRANCH =~ /^(staging<span class=\"token punctuation\">|</span>main)$/\n    <span class=\"token key atrule\">when</span><span class=\"token punctuation\">:</span> delayed\n    <span class=\"token key atrule\">allow_failure</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">start_in</span><span class=\"token punctuation\">:</span> 5 seconds</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>whatever is inside <code class=\"language-text\">when</code> will only count if the <code class=\"language-text\">if</code> of a rule evaluates to true</li>\n<li>defaults are <code class=\"language-text\">when: on_success</code> and <code class=\"language-text\">allow_failure: false</code></li>\n<li>we can have a catch all logic, e.g. <code class=\"language-text\">when: always</code> as the last rule</li>\n</ul>\n<h1 id=\"pipelines\" style=\"position:relative;\"><a href=\"#pipelines\" aria-label=\"pipelines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pipelines</h1>\n<p>the different types of pipelines are -</p>\n<ul>\n<li>basic pipelines</li>\n<li>dag (directed acyclic graph) pipelines</li>\n<li>multi project pipelines</li>\n<li>parent child pipelines</li>\n<li>pipelines for merge requests</li>\n<li>pipelines for merge results (premium only)</li>\n<li>merge trains (premium only)</li>\n</ul>\n<h3 id=\"dag-pipelines\" style=\"position:relative;\"><a href=\"#dag-pipelines\" aria-label=\"dag pipelines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DAG Pipelines</h3>\n<ul>\n<li>dag - direct acyclic graph</li>\n<li>by default, jobs in stage x + 1 do not start executing unless all jobs in stage x are complete</li>\n<li>we might need to speed up our pipelines, since it might happen that all jobs of stage x + 1 do not need all jobs of stage x to finish successfully. e.g. <code class=\"language-text\">test_a</code> is having to wait for <code class=\"language-text\">build_b</code> even though it does not depend on it\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> build\n  <span class=\"token punctuation\">-</span> test\n\n<span class=\"token key atrule\">.common</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> echo \"ran job $CI_JOB_NAME successfully\"\n\n<span class=\"token key atrule\">build_a</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> .common\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> build\n\n<span class=\"token key atrule\">build_b</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> .common\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> build\n  <span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> sleep 10\n\n<span class=\"token key atrule\">test_a</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> .common\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> test\n\n<span class=\"token key atrule\">test_b</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> .common\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> test</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>we use the <code class=\"language-text\">needs</code> keyword in this case. optimized code -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">test_a</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># ...</span>\n  <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> build_a\n\n<span class=\"token key atrule\">test_b</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># ...</span>\n  <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> build_b</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<p>a comparison of with vs without dag pipeline</p>\n<div class=\"blog--divider\">\n  <div class=\"blog--left\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 448px; margin: 5px 0 5px 0 !important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1be0850afaa256f6057564b9a4a6f71b/33b38/without-dag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQoz4VS2W6DQAzkQ2AXCGeCuGHJASkQ0grx/78zlZ2SJlLSPlhew3h27FmtqirM84y+7+G6LpIk4RwEAaIo4rPv+3wOwxBSSggh3oYWxzEOhwPKsoTneRyO49yJ6Eyxfrcs68/QDMOAaZrcYNs2qH5184qhJqpJ6avQdF1HURQ8Nimi+pGIQHTJZrPBOI4vMU8jc5OQsKXJKihIKRFQftyZJU1W+A7DCqUhEBYJoqXDdJmwLAuapkFd1xiGgcckRZ7vYzufcJx6zJ9fjCFDCUMG0hRMKAwBdxtgty/YGKUUsixDmqbI8/y+V8phkyOrCqi6Zgy9iBVzV0iEfrzD9qNmt8/nM++UCEkFOUuEjusg6CqUxwbt6YT8AUMv4klhkEbYXfboug7X65XHJdK2bW9g3YDruQgHBdUdMY0X1EqxOsLQWn4J2RQBS9wWu/6gxT86LX4w8h/MN1uHJHaLmBMnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"without dag\"\n        title=\"without dag\"\n        src=\"/static/1be0850afaa256f6057564b9a4a6f71b/33b38/without-dag.png\"\n        srcset=\"/static/1be0850afaa256f6057564b9a4a6f71b/c26ae/without-dag.png 158w,\n/static/1be0850afaa256f6057564b9a4a6f71b/6bdcf/without-dag.png 315w,\n/static/1be0850afaa256f6057564b9a4a6f71b/33b38/without-dag.png 448w\"\n        sizes=\"(max-width: 448px) 100vw, 448px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n  </div>\n  <div class=\"blog--right\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 498px; margin: 5px 0 5px 0 !important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9121f90b083f7fe7296226d6e62fa949/79e1b/with-dag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByklEQVQoz01Tba7aMBDMLaoHSRzbJCTw+A6QLygBqioB1B6gx+gFe7KpZnlG/Bits2uPd8Ybr21b7HY7jEYjTKdTGGOQpqnAWossy2TNfBiGUEp9IUIUPeFyrHvH41EIeXg8HkuB5AQ3MO/WQRBIfTgcYjAY4OPjm0R+s05yjyTsbDKZyOH1eo3ZbIb5fI7NZoPVaiXgmnsIqmrPV3S3X7hcrzidTtIML/QulwvO57MkSdT3vXyz88fjIbjf7xKLooA2FmmisW3/4Pfff9gf78jSMbR+WuKxXSeBCd/3X9IY3+G88v0hAqWhzARBqOQM8yLZGTsyFkZrMZ/SGd8Nd6ZrFcEaC60jGK1grYHW+rXHC/0A4/kUnz8qkUtp9JHy9vu9EAusQawtskOO7c/vePR3VFUl3jZNI02Ih2EQIs5SzOot6qYWksViIS/Px3jvMAoV0nyBdVOgKkosV0sh5F52KR6ScJTEmOZL6Yq3kZDgizpvBEqJmuV2g6oshcxNBOtPQj9Auprhs2vQ327oug55nuNwOKCua7nZyabkSbvHrm/x6G4oy1K64xhxVp+SvwYyiWPEcSwFxiRJXn/HO/ggrLnhd2v3F/0H2uZIkxdkSn8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"with dag\"\n        title=\"with dag\"\n        src=\"/static/9121f90b083f7fe7296226d6e62fa949/79e1b/with-dag.png\"\n        srcset=\"/static/9121f90b083f7fe7296226d6e62fa949/c26ae/with-dag.png 158w,\n/static/9121f90b083f7fe7296226d6e62fa949/6bdcf/with-dag.png 315w,\n/static/9121f90b083f7fe7296226d6e62fa949/79e1b/with-dag.png 498w\"\n        sizes=\"(max-width: 498px) 100vw, 498px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n  </div>\n</div>\n<h3 id=\"parent-child-pipelines\" style=\"position:relative;\"><a href=\"#parent-child-pipelines\" aria-label=\"parent child pipelines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Parent Child Pipelines</h3>\n<ul>\n<li>parent pipeline triggers child pipelines</li>\n<li>note: a job should either have a script or a trigger</li>\n<li>used for separation of concern, e.g. monorepo with microservices</li>\n<li>using <code class=\"language-text\">strategy: depend</code>, the job will mirror the status of the target pipeline, otherwise it goes green immediately after triggering the target pipeline and continues with the source pipeline</li>\n<li>such jobs which trigger other pipelines are called bridge jobs</li>\n<li>for now, i like to think that multi project pipeline works in the same way as parent child pipelines, with the exception that instead of <code class=\"language-text\">include</code>, we use the <code class=\"language-text\">project</code> key under <code class=\"language-text\">trigger</code></li>\n<li>variables set in the source pipeline are passed to the child pipeline</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> triggers\n\n<span class=\"token key atrule\">trigger_a</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> triggers\n  <span class=\"token key atrule\">trigger</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span> a/.gitlab<span class=\"token punctuation\">-</span>ci.yml\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span> depend\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">changes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> a/*\n\n<span class=\"token key atrule\">trigger_b</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> triggers\n  <span class=\"token key atrule\">trigger</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span> b/.gitlab<span class=\"token punctuation\">-</span>ci.yml\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span> depend\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">changes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> b/*</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>only one can be expanded at a time in ui -</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; margin: 5px 0 5px 0 !important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a7df66afb8695efbb4e953b08d8991e1/0f67e/parent-child.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVQoz42SS07DMBRFsw6axE7iNB+n9S9Jm1ZApUpICMEi2P8eDoqBMgMGd+LBeb7nvWSaJvq+p67rW5RS5HmOEBIpJUKIfycx+z3OOdI0/XrMGbQmBI+qKrIsi/A1K/yvJEpr3HHBWk+/MxRFiRoapuWEsZ6u69Ba0zTNDfxbksYcOVzfOSxX/DhTlhWdu2d5fGWeZ7z3jOOIMeZ/lRtjWa5vnM4XfBgpy5LGOs6XJ6b5iLUmQtdfripqpdhsNlFFURR0bRt1fatJ6naHDi/oXWAYegqZ09kHxtMzIYxYayNwNwyooSUcZrxzcYCQAj05QgixQVVVJHmWkaV3ZNnPFClkXI4U4iZ7rVPUFf2gadv28xKEoO7beCXb7TYu5QMKzcs1CBMoHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"parent child pipeline\"\n        title=\"parent child pipeline\"\n        src=\"/static/a7df66afb8695efbb4e953b08d8991e1/f058b/parent-child.png\"\n        srcset=\"/static/a7df66afb8695efbb4e953b08d8991e1/c26ae/parent-child.png 158w,\n/static/a7df66afb8695efbb4e953b08d8991e1/6bdcf/parent-child.png 315w,\n/static/a7df66afb8695efbb4e953b08d8991e1/f058b/parent-child.png 630w,\n/static/a7df66afb8695efbb4e953b08d8991e1/0f67e/parent-child.png 921w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"merge-pipelines\" style=\"position:relative;\"><a href=\"#merge-pipelines\" aria-label=\"merge pipelines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Merge Pipelines</h3>\n<ul>\n<li>merge request pipeline runs on the source branch ignoring the target branch</li>\n<li>merge result pipeline runs on the result of merging the source branch with the target branch</li>\n<li>merge trains run on the result of multiple merges\n<ul>\n<li>e.g. first feature/one created an mr to main and then feature/two created an mr to main</li>\n<li>the first pipeline will run on the merge_result(feature/one, main)</li>\n<li>the second pipeline will run on the merge_result(feature/two, merge_result(feature/one, main))</li>\n</ul>\n</li>\n<li>my understanding - in gitlab premium, we get options in settings -> general -> merge requests depending on when we want to run the merge pipeline. otherwise it is a merge request pipeline by default since the other two are gitlab premium features. syntax for all three in the pipeline file is the same</li>\n<li>old <code class=\"language-text\">only</code> syntax -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> merge_requests</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>new <code class=\"language-text\">rules</code> syntax -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_PIPELINE_SOURCE == 'merge_request_event'</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id=\"workflow\" style=\"position:relative;\"><a href=\"#workflow\" aria-label=\"workflow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Workflow</h1>\n<ul>\n<li>we can specify the rules at the pipeline level instead of specifying on the job level, e.g. -\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">workflow</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_TAG\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_BRANCH</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>we can use <a href=\"https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates/Workflows\">this</a> for common scenarios to prevent issues like duplicate pipelines\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Workflows/Branch-Pipelines.gitlab-ci.yml'</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id=\"docker-in-docker\" style=\"position:relative;\"><a href=\"#docker-in-docker\" aria-label=\"docker in docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker in Docker</h1>\n<ul>\n<li>we might have a use case like docker pushing to the container registry</li>\n<li>docker in docker or dind helps run docker commands from inside containers</li>\n<li>the container the job runs commands on has the docker client</li>\n<li>we run the docker daemon as a service</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\">  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker<span class=\"token punctuation\">:</span>20.10.16\n  <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> docker<span class=\"token punctuation\">:</span>20.10.16<span class=\"token punctuation\">-</span>dind</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>","frontmatter":{"title":"Gitlab CI CD"}}},"pageContext":{"id":"cf4a747e-58d7-5f66-8075-5501f169ab11"}},"staticQueryHashes":["1037383464","1617985380"]}