{"componentChunkName":"component---src-templates-blog-js","path":"/terraform-aws-network/","result":{"data":{"markdownRemark":{"fields":{"slug":"/terraform-aws-network/"},"id":"8ed11853-9158-5ab2-bcee-bade01ba8c31","html":"<p>using <code class=\"language-text\">element(list.*.id, index)</code> and <code class=\"language-text\">list[index].id</code> has no difference, except that the element function has wrap around behavior, i.e. <code class=\"language-text\">list[length_of_list].id</code> will fail while <code class=\"language-text\">element(list.*.id, length_of_list)</code> will refer to the id of the first element of the list</p>\n<p>main.tf</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-hcl line-numbers\"><code class=\"language-hcl\"><span class=\"token keyword\">terraform</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">required_version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"1.2.1\"</span>\n\n  <span class=\"token keyword\">required_providers</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">aws</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">source</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"hashicorp/aws\"</span>\n      <span class=\"token property\">version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"4.16.0\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">provider<span class=\"token type variable\"> \"aws\" </span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">region</span> <span class=\"token punctuation\">=</span> var.region\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data <span class=\"token type variable\">\"aws_region\"</span></span> <span class=\"token string\">\"main\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data <span class=\"token type variable\">\"aws_availability_zones\"</span></span> <span class=\"token string\">\"main\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>variables.tf</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-hcl line-numbers\"><code class=\"language-hcl\"><span class=\"token keyword\">variable<span class=\"token type variable\"> \"region\" </span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">default</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"us-east-1\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">variable<span class=\"token type variable\"> \"cidr\" </span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">default</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"10.0.0.0/16\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">variable<span class=\"token type variable\"> \"availablity_count\" </span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">default</span> <span class=\"token punctuation\">=</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>vpc.tf</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-hcl line-numbers\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_vpc\"</span></span> <span class=\"token string\">\"main\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">cidr_block</span> <span class=\"token punctuation\">=</span> var.cidr\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>subnets.tf</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-hcl line-numbers\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_subnet\"</span></span> <span class=\"token string\">\"private\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>             <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">cidr_block</span>        <span class=\"token punctuation\">=</span> cidrsubnet(aws_vpc.main.cidr_block, <span class=\"token number\">8</span>, count.index + <span class=\"token number\">1</span>)\n  <span class=\"token property\">availability_zone</span> <span class=\"token punctuation\">=</span> data.aws_availability_zones.main.names<span class=\"token punctuation\">[</span>count.index<span class=\"token punctuation\">]</span>\n  <span class=\"token property\">vpc_id</span>            <span class=\"token punctuation\">=</span> aws_vpc.main.id\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_subnet\"</span></span> <span class=\"token string\">\"public\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>                   <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">cidr_block</span>              <span class=\"token punctuation\">=</span> cidrsubnet(aws_vpc.main.cidr_block, <span class=\"token number\">8</span>, count.index + <span class=\"token number\">101</span>)\n  <span class=\"token property\">availability_zone</span>       <span class=\"token punctuation\">=</span> data.aws_availability_zones.main.names<span class=\"token punctuation\">[</span>count.index<span class=\"token punctuation\">]</span>\n  <span class=\"token property\">vpc_id</span>                  <span class=\"token punctuation\">=</span> aws_vpc.main.id\n  <span class=\"token property\">map_public_ip_on_launch</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>igw.tf</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-hcl line-numbers\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_internet_gateway\"</span></span> <span class=\"token string\">\"main\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">vpc_id</span> <span class=\"token punctuation\">=</span> aws_vpc.main.id\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>ngw.tf</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-hcl line-numbers\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_eip\"</span></span> <span class=\"token string\">\"ngw\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span> <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">vpc</span>   <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_nat_gateway\"</span></span> <span class=\"token string\">\"main\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>         <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">allocation_id</span> <span class=\"token punctuation\">=</span> element(aws_eip.ngw.*.id, count.index)\n  <span class=\"token property\">subnet_id</span>     <span class=\"token punctuation\">=</span> element(aws_subnet.public.*.id, count.index)\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>public_rt.tf</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-hcl line-numbers\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_route_table\"</span></span> <span class=\"token string\">\"public\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>  <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">vpc_id</span> <span class=\"token punctuation\">=</span> aws_vpc.main.id\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_route_table_association\"</span></span> <span class=\"token string\">\"public\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>          <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">route_table_id</span> <span class=\"token punctuation\">=</span> element(aws_route_table.public.*.id, count.index)\n  <span class=\"token property\">subnet_id</span>      <span class=\"token punctuation\">=</span> element(aws_subnet.public.*.id, count.index)\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_route\"</span></span> <span class=\"token string\">\"public_to_igw\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>                  <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">destination_cidr_block</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"0.0.0.0/0\"</span>\n  <span class=\"token property\">route_table_id</span>         <span class=\"token punctuation\">=</span> element(aws_route_table.public.*.id, count.index)\n  <span class=\"token property\">gateway_id</span>             <span class=\"token punctuation\">=</span> aws_internet_gateway.main.id\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>private_rt.tf</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-hcl line-numbers\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_route_table\"</span></span> <span class=\"token string\">\"private\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>  <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">vpc_id</span> <span class=\"token punctuation\">=</span> aws_vpc.main.id\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_route_table_association\"</span></span> <span class=\"token string\">\"private\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>          <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">route_table_id</span> <span class=\"token punctuation\">=</span> element(aws_route_table.private.*.id, count.index)\n  <span class=\"token property\">subnet_id</span>      <span class=\"token punctuation\">=</span> element(aws_subnet.private.*.id, count.index)\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">resource <span class=\"token type variable\">\"aws_route\"</span></span> <span class=\"token string\">\"private_to_ngws\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span>                  <span class=\"token punctuation\">=</span> var.availablity_count\n  <span class=\"token property\">destination_cidr_block</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"0.0.0.0/0\"</span>\n  <span class=\"token property\">route_table_id</span>         <span class=\"token punctuation\">=</span> element(aws_route_table.private.*.id, count.index)\n  <span class=\"token property\">nat_gateway_id</span>         <span class=\"token punctuation\">=</span> element(aws_nat_gateway.main.*.id, count.index)\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","frontmatter":{"title":"Terraform AWS Network"}}},"pageContext":{"id":"8ed11853-9158-5ab2-bcee-bade01ba8c31"}},"staticQueryHashes":["1037383464","1617985380"]}