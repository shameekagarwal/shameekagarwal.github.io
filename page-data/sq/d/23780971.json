{"data":{"allMarkdownRemark":{"nodes":[{"fields":{"slug":"/online-judge/"},"frontmatter":{"title":"Online Judge","order":1},"html":"<p>The project is about making an online portal where users can come in to submit their solutions to programming problems. In other words, it is a basic rip-off of <a href=\"https://leetcode.com/\">Leetcode</a>. My friend, <a href=\"https://gitlab.com/iamyashm\">Yash Maniramka</a> worked on the Frontend bit of it using VueJS while I worked on Backend and Devops. In this post, I would be talking about the application itself and the parts that I worked on. The source code for the project can be found <a href=\"https://gitlab.com/shameekagarwal/online-judge\">here</a>.</p>\n<h3 id=\"actors-in-the-application\" style=\"position:relative;\"><a href=\"#actors-in-the-application\" aria-label=\"actors in the application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Actors in the Application</h3>\n<ul>\n<li><code class=\"language-text\">users</code> are the people who submit their solutions to problems in a programming language of their choice.</li>\n<li><code class=\"language-text\">managers</code> can access various actuator endpoints for monitoring the health and status of the application. They can also perform operations like changing the log level during runtime.</li>\n<li><code class=\"language-text\">admins</code> can create questions with testcases and delete questions.</li>\n</ul>\n<h3 id=\"demo\" style=\"position:relative;\"><a href=\"#demo\" aria-label=\"demo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Demo</h3>\n<video controls>\n  <source src=\"/81cabec3f612d711de20a3e200674fdb/demo.mp4\" type=\"video/mp4\">\n</video>\n<br />\n<br />\n<h3 id=\"microservices\" style=\"position:relative;\"><a href=\"#microservices\" aria-label=\"microservices permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Microservices</h3>\n<p>DDD has been used to split the backend into three different services - account service, question service and submission service.</p>\n<p>Account service has endpoints for creating a user and logging in a user i.e. returning the JWT token if the credentials are valid. It also has an endpoint for creating the initial roles and superusers.</p>\n<p>Question service has endpoints for creating a question, listing questions, deleting a question and fetching a question details. For returning the question details, the question service also calls the submission service for fetching the submissions of the user (if logged in).</p>\n<p>Submission service has an endpoint for creating a submission which then gets evaluated asynchronously in the backend. It also has endpoints for fetching all the submissions for a particular question for the logged-in user and fetching analytics which returns details about the total number of passed and failed submissions for a question. It also listens for events of creation of an account and creation / deletion of a question. This is required so that the submission service can maintain mappings for submissions to accounts and questions in its database.</p>\n<h3 id=\"data-model\" style=\"position:relative;\"><a href=\"#data-model\" aria-label=\"data model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Model</h3>\n<p>Polyglot persistence has been used in the application to increase fault tolerance, so each service has its own database (technically, each service has a separate schema in the same database). This is an ER diagram, and the actual attributes after the application was developed may differ a little.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; margin: 5px 0 5px 0 !important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebbafafd0ae2a9438862c2edc00e8a9f/02cd5/er-diagram.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDklEQVQoz32SiYrFMAhF8/9fWVq67/tehyM4hDd9I0iMmuvV6JIkkbIsJU1TieNYz2+y77vmHMeh9+d5/uQ4kpZlkXEcZZ5nua5L1nWV8zzlvm+9c6J930sYhrJt23dAHjZNI1VVKeAwDFIUhdR1LV3XKfs8zxUMHx39C4gThjw0VtyxiVGEGG3SBSPxWzZQsx0XAGBDe59CDHYUAqhtWy3mg/j6CuhXJsYY3oq9iQJa5c+5YMNsmqZfG3BmiA1T+zR8zNgBBjsAbXYm2HwWnwQon2OrxVyDIFDNskzB8DvQWR0GDrjfLn4YMUNOWx389nmQ4Z11qS2THEWRJpnQAj4YojCDib/k7CRK3Gb4A0T5CqK8Hr2XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"er diagram\"\n        title=\"er diagram\"\n        src=\"/static/ebbafafd0ae2a9438862c2edc00e8a9f/f058b/er-diagram.png\"\n        srcset=\"/static/ebbafafd0ae2a9438862c2edc00e8a9f/c26ae/er-diagram.png 158w,\n/static/ebbafafd0ae2a9438862c2edc00e8a9f/6bdcf/er-diagram.png 315w,\n/static/ebbafafd0ae2a9438862c2edc00e8a9f/f058b/er-diagram.png 630w,\n/static/ebbafafd0ae2a9438862c2edc00e8a9f/02cd5/er-diagram.png 821w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<br /></p>\n<h3 id=\"backend-implementation-details\" style=\"position:relative;\"><a href=\"#backend-implementation-details\" aria-label=\"backend implementation details permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Backend Implementation Details</h3>\n<p>A maven multimodule project has been used. This helps in using a shared folder, where all common functionality like parsing JWT, error handling, etc. are present. This project follows a mono repo pattern.</p>\n<p>Spring Boot has been used for implementing the backed. Hibernate Validator has been used for validating the DTOs. Spring Data JPA has been used for implementing the DAO layer and the database used is MySQL. Database migrations are handled via Flyway. Spring Batch has been used for evaluating the submissions against testcases in batches. Actuator has also been used for monitoring the application during runtime. The application implements RBAC using JWT and Spring Security.</p>\n<p>For implementing microservices patterns, Netfllix Eureka has been used for Discovery Server and Client Side Load Balancing, Spring Cloud Config for managing configuration using a config-first approach and Spring Cloud Gateway to expose the different microservices from a common endpoint i.e. the services cannot be accessed directly. Resilience4J and Open Feign have been used for synchronous communication and RabbitMQ for asynchronous communication.</p>\n<p>Tests for the backend have been written using Junit, Mockito and Springâ€™s support for testing, with primary focus on integration tests using the inmemory database H2.</p>\n<h3 id=\"devops-implementation-details\" style=\"position:relative;\"><a href=\"#devops-implementation-details\" aria-label=\"devops implementation details permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Devops Implementation Details</h3>\n<p>Docker along with Docker-Compose has been used.</p>\n<p>Different AWS services have been used, e.g. IAM, ECS and ECR for managing Docker, components of VPC including NAT Gateways, Internet Gateway, etc. to set up a sandboxed environment, S3 for serving the static frontend files, RDS and Amazon MQ for backing services, ALB for exposing the backend, Cloudwatch for logs and EC2 for a bastion. The backing services and ECS containers are launched in the private subnet. The backing services can only be accessed via the bastion which helps in, for instance, running the initial database scripts like creating database schemas and setting up users.</p>\n<p>IAC has been implemented via Terraform. Terraform workspaces help in setting up different environments for development, staging and production. For managing secrets like database user passwords, terraform variables have been used which are injected through Gitlab CI-CD variables. The state is managed via S3 + DynamoDB.</p>\n<p>Gitlab pipelines are used for implementing CI/CD. It offers a rich set of features used in this project like artifacts, cache, DIND, parent-child and DAG pipelines to name a few. Gitlab is also used for issue tracking in this project.</p>","excerpt":"The project is about making an online portal where users can come in to submit their solutions to programming problems. In other words, itâ€¦"}]}}}